From d076fc3515e6fc705495ec97b4c8ed89edd157f3 Mon Sep 17 00:00:00 2001
From: Serge Ayoun <serge.ayoun@intel.com>
Date: Thu, 2 May 2019 11:23:08 +0300
Subject: [PATCH 1/5] For kernel 5.1 and higher, sgx_vma_fault returns unsigned
 int. Change propagated from master branch.

Signed-off-by: Serge Ayoun <serge.ayoun@intel.com>
---
 sgx_vma.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/sgx_vma.c b/sgx_vma.c
index bcd1047..34ec7bb 100644
--- a/sgx_vma.c
+++ b/sgx_vma.c
@@ -102,7 +102,11 @@ static void sgx_vma_close(struct vm_area_struct *vma)
 	kref_put(&encl->refcount, sgx_encl_release);
 }
 
-#if (LINUX_VERSION_CODE >= KERNEL_VERSION(4,11,0))
+#if (LINUX_VERSION_CODE >= KERNEL_VERSION(5,1,0))
+static unsigned int sgx_vma_fault(struct vm_fault *vmf)
+{
+	struct vm_area_struct *vma = vmf->vma;
+#elif (LINUX_VERSION_CODE >= KERNEL_VERSION(4,11,0))
 static int sgx_vma_fault(struct vm_fault *vmf)
 {
 	struct vm_area_struct *vma = vmf->vma;
-- 
2.21.0

